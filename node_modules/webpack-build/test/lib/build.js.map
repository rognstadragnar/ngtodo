{"version":3,"sources":["../src/build.js"],"names":[],"mappings":"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","file":"build.js","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport _ from 'lodash';\nimport mkdirp from 'mkdirp';\nimport build from '../../lib';\nimport Wrapper from '../../lib/wrappers/Wrapper';\nimport wrappers from '../../lib/wrappers';\nimport workers from '../../lib/workers';\nimport caches from '../../lib/caches';\nimport utils from './utils';\n\nlet TEST_OUTPUT_DIR = utils.TEST_OUTPUT_DIR;\nlet assert = utils.assert;\n\n// Ensure we have a clean slate before and after each test\nbeforeEach(() => {\n  wrappers.clear();\n  caches.clear();\n  workers.killAll();\n  utils.cleanTestOutputDir();\n});\nafterEach(() => {\n  wrappers.clear();\n  caches.clear();\n  workers.killAll();\n  utils.cleanTestOutputDir();\n});\n\ndescribe('build', () => {\n  it('should be a function', () => {\n    assert.isFunction(build);\n  });\n  it('should accept options and callback arguments', () => {\n    let opts = {\n      config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config')\n    };\n    build(opts, () => {});\n  });\n  it('should populate the wrappers list', (done) => {\n    let basicBundle = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n    let libraryBundle = path.join(__dirname, 'test_bundles', 'library_bundle', 'webpack.config.js');\n\n    let opts1 = {\n      config: basicBundle\n    };\n    assert.equal(Object.keys(wrappers.wrappers).length, 0);\n\n    build(opts1, () => {});\n\n    _.defer(() => {\n      assert.equal(Object.keys(wrappers.wrappers).length, 1);\n      assert.strictEqual(wrappers.wrappers[opts1.buildHash].opts, opts1);\n\n      let opts2 = {\n        config: basicBundle\n      };\n      build(opts2, () => {});\n\n      _.defer(() => {\n        assert.strictEqual(wrappers.wrappers[opts2.buildHash], wrappers.wrappers[opts1.buildHash]);\n        assert.equal(Object.keys(wrappers.wrappers).length, 1);\n        assert.strictEqual(wrappers.wrappers[opts2.buildHash].opts, opts1);\n\n        let opts3 = {\n          config: libraryBundle\n        };\n        build(opts3, () => {});\n\n        _.defer(() => {\n          assert.equal(Object.keys(wrappers.wrappers).length, 2);\n          assert.strictEqual(wrappers.wrappers[opts3.buildHash].opts, opts3);\n\n          let opts4 = {\n            config: basicBundle\n          };\n          build(opts4, () => {});\n\n          _.defer(() => {\n            assert.equal(Object.keys(wrappers.wrappers).length, 2);\n            assert.deepEqual(wrappers.wrappers[opts4.buildHash].opts, opts4);\n\n            done();\n          });\n        });\n      });\n    });\n  });\n  it('should be able to generate a bundle', (done) => {\n    build({\n      config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js')\n    }, (err, data) => {\n      assert.isNull(err);\n      assert.isObject(data);\n\n      assert.isArray(data.assets);\n      assert.isObject(data.outputOptions);\n\n      let existsAt = data.assets[0];\n      assert.isString(existsAt);\n\n      fs.readFile(existsAt, (err, contents) => {\n        assert.isNull(err);\n        let compiledBundle = contents.toString();\n        assert.include(compiledBundle, '__BASIC_BUNDLE_ENTRY_TEST__');\n        assert.include(compiledBundle, '__BASIC_BUNDLE_REQUIRE_TEST__');\n        done();\n      });\n    });\n  });\n  it('should check mtimes to detect stale config files', (done) => {\n    let configFile = path.join(TEST_OUTPUT_DIR, 'stale_config_file.js');\n\n    mkdirp.sync(path.dirname(configFile));\n    fs.writeFileSync(configFile, 'module.exports = function(){ return {}; }');\n    let initialMTime = +fs.statSync(configFile).mtime;\n\n    build({\n      config: configFile\n    }, (err, data) => {\n      assert.isNull(err);\n      assert.isObject(data);\n\n      // Need to delay due to file system accuracy issues\n      setTimeout(function() {\n        fs.writeFileSync(configFile, 'module.exports = {test: 1}');\n        assert.notEqual(+fs.statSync(configFile).mtime, initialMTime);\n\n        build({\n          config: configFile\n        }, (err, data) => {\n          assert.instanceOf(err, Error);\n          done();\n        });\n      }, 1000);\n    });\n  });\n  it('should indicate if a config file does not exist', (done) => {\n    let configFile = path.join(TEST_OUTPUT_DIR, 'non_existent_config_file.js');\n\n    assert.throws(() => {\n      fs.statSync(configFile);\n    });\n\n    build({\n      config: configFile\n    }, (err, data) => {\n      assert.instanceOf(err, Error);\n      assert.isNull(data);\n\n      assert.include(err.message, `Cannot find config file ${configFile}`);\n\n      done();\n    });\n  });\n  it('should indicate if importing a config file produced errors', (done) => {\n    let configFile = path.join(TEST_OUTPUT_DIR, 'broken_config_file.js');\n\n    mkdirp.sync(path.dirname(configFile));\n    fs.writeFileSync(configFile, 'require(\"package-that-does-not-exist\");');\n\n    build({\n      config: configFile\n    }, (err, data) => {\n      assert.instanceOf(err, Error);\n      assert.isNull(data);\n\n      assert.include(err.message, `Failed to import config file ${configFile}`);\n\n      done();\n    });\n  });\n  it('should expose the default options', () => {\n    assert.isFunction(build.options);\n    assert.isObject(build.options.defaults);\n    assert.isObject(build.options.defaults);\n  });\n  describe('file cache', () => {\n    it('should respect the cacheDir and cacheFile options', (done) => {\n      let cacheFile = path.join(TEST_OUTPUT_DIR, 'test_cacheFile.json');\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      mkdirp.sync(path.dirname(cacheFile));\n\n      fs.writeFileSync(cacheFile, JSON.stringify({\n        startTime: +new Date() + 2000,\n        fileDependencies: [],\n        dependencies: [],\n        stats: {\n          test: {foo: 'bar'}\n        },\n        config: {\n          file: configFile\n        },\n        buildHash: 'foo',\n        assets: []\n      }));\n\n      build({\n        config: configFile,\n        cacheFile: cacheFile,\n        buildHash: 'foo'\n      }, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.deepEqual(data.stats, {test: {foo: 'bar'}});\n        done();\n      });\n    });\n    it('should generate a cache file in the cache dir', (done) => {\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      let opts = {\n        config: configFile\n      };\n\n      build(opts, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.isString(opts.cacheFile);\n        assert.include(opts.cacheFile, opts.cacheDir);\n\n        done();\n      });\n    });\n    it('should generate a cache file from the config file and options hash', (done) => {\n      let configFile = path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js');\n\n      let opts = {\n        config: configFile\n      };\n\n      build(opts, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.strictEqual(wrappers.wrappers[opts.buildHash].opts, opts);\n\n        caches.get(opts, (_err, _data) => {\n          assert.isNull(_err);\n          assert.deepEqual(_data, data);\n\n          assert.isString(opts.config);\n          assert.isString(opts.buildHash);\n          assert.equal(opts.cacheFile, path.join(opts.cacheDir, opts.buildHash + '.json'));\n\n          assert.equal(caches._caches.get(opts).filename, opts.cacheFile);\n\n          done();\n        });\n      });\n    });\n    it('should stop serving cached data once a watcher has completed', (done) => {\n      let cacheFile = path.join(TEST_OUTPUT_DIR, 'test_cache_stops_once_watcher_done.json');\n      let configFile = path.join(TEST_OUTPUT_DIR, 'test_cache_stops_once_watcher_done.js');\n\n      mkdirp.sync(TEST_OUTPUT_DIR);\n\n      fs.writeFileSync(cacheFile, JSON.stringify({\n        startTime: +new Date() + 2000,\n        fileDependencies: [],\n        dependencies: [],\n        stats: {\n          test: {foo: 'bar'}\n        },\n        config: {\n          file: configFile\n        },\n        buildHash: 'foo',\n        assets: []\n      }));\n\n      fs.writeFileSync(configFile, `\n        module.exports = require('${path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js')}');\n      `);\n\n      let opts = {\n        config: configFile,\n        cacheFile: cacheFile,\n        watch: true,\n        buildHash: 'foo'\n      };\n\n      build(opts, (err1, data1) => {\n        assert.isNull(err1);\n        assert.isObject(data1);\n        assert.deepEqual(data1.stats, {test: {foo: 'bar'}});\n\n        let cache = caches._caches.get(opts);\n        assert.deepEqual(data1.stats, cache.data.stats);\n        assert.isFalse(cache.delegate);\n\n        build(opts, (err2, data2) => {\n          assert.isNull(err2);\n          assert.isObject(data2);\n\n          assert.strictEqual(data2, data1);\n          assert.deepEqual(data2.stats, {test: {foo: 'bar'}});\n          assert.isFalse(cache.delegate);\n\n          setTimeout(() => {\n            let wrapper = wrappers.wrappers[opts.buildHash];\n\n            wrapper.onceDone((err, data3) => {\n              assert.isNull(err);\n              assert.isObject(data3);\n              assert.notStrictEqual(data3, data2);\n\n              assert.isString(cache.data.buildHash);\n              assert.equal(cache.data.buildHash, opts.buildHash);\n              assert.equal(cache.data.buildHash, wrapper.opts.buildHash);\n\n              assert.isTrue(cache.delegate);\n\n              build(opts, (err, data4) => {\n                assert.isNull(err);\n                assert.isObject(data4);\n                assert.deepEqual(data4.stats, data3.stats);\n\n                done();\n              });\n            });\n          }, 50);\n        });\n      });\n    });\n  });\n  describe('workers', () => {\n    it('should expose the workers', () => {\n      assert.strictEqual(build.workers, workers);\n    });\n    it('should be used if they are available', (done) => {\n      build.workers.spawn(2);\n\n      assert.isTrue(build.workers.available());\n\n      let opts = {\n        config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js')\n      };\n\n      assert.equal(Object.keys(wrappers.wrappers).length, 0);\n      assert.equal(Object.keys(workers.matches).length, 0);\n      assert.isUndefined(workers.match(opts));\n\n      build(opts, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        assert.equal(Object.keys(wrappers.wrappers).length, 0);\n        assert.equal(Object.keys(workers.matches).length, 1);\n        assert.equal(workers.matches[opts.buildHash], workers.workers[0].id);\n        assert.strictEqual(workers.match(opts), workers.workers[0]);\n\n        build(opts, (_err, _data) => {\n          assert.isNull(_err);\n          assert.isObject(_data);\n\n          assert.equal(Object.keys(wrappers.wrappers).length, 0);\n          assert.equal(Object.keys(workers.matches).length, 1);\n          assert.equal(workers.matches[opts.buildHash], workers.workers[0].id);\n          assert.strictEqual(workers.match(opts), workers.workers[0]);\n\n          assert.deepEqual(_data, data);\n\n          done();\n        });\n      });\n    });\n    it('should populate the cache via signals', (done) => {\n      build.workers.spawn();\n\n      assert.isTrue(build.workers.available());\n\n      let opts = {\n        config: path.join(__dirname, 'test_bundles', 'basic_bundle', 'webpack.config.js')\n      };\n\n      build(opts, (err, data) => {\n        assert.isNull(err);\n        assert.isObject(data);\n\n        setTimeout(() => {\n          assert.equal(Object.keys(wrappers.wrappers).length, 0);\n          let cache = caches._caches.get(opts);\n          assert.deepEqual(data, cache.data);\n\n          done();\n        }, 50);\n      });\n    });\n  });\n});"]}