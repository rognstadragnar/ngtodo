{"version":3,"sources":["../src/Watcher.js"],"names":[],"mappings":"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","file":"Watcher.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport _ from 'lodash';\nimport mkdirp from 'mkdirp';\nimport webpack from 'webpack';\nimport Watcher from '../../lib/wrappers/Watcher';\nimport options from '../../lib/options';\nimport utils from './utils';\nimport basic_bundle from './test_bundles/basic_bundle/webpack.config';\n\nlet assert = utils.assert;\nlet TEST_OUTPUT_DIR = utils.TEST_OUTPUT_DIR;\n\n// Ensure we have a clean slate before and after each test\nbeforeEach(() => {\n  utils.cleanTestOutputDir();\n});\nafterEach(() => {\n  utils.cleanTestOutputDir();\n});\n\ndescribe('Watcher', () => {\n  it('should be a function', () => {\n    assert.isFunction(Watcher);\n  });\n  it('should accept compiler and option arguments', () => {\n    let compiler = webpack({});\n    let opts = {buildHash:'foo'};\n    let watcher = new Watcher(compiler, opts);\n    assert.strictEqual(watcher.compiler, compiler);\n    assert.strictEqual(watcher.opts, opts);\n  });\n  describe('#onInvalid & #onDone', () => {\n    it('should provide hooks into the compilation process', (done) => {\n      let entry = path.join(TEST_OUTPUT_DIR, 'hook_test', 'entry.js');\n      let output = path.join(TEST_OUTPUT_DIR, 'hook_test', 'output.js');\n      let config = {\n        context: path.dirname(entry),\n        entry: './' + path.basename(entry),\n        output: {\n          path: path.dirname(output),\n          filename: path.basename(output)\n        }\n      };\n      mkdirp.sync(path.dirname(entry));\n      fs.writeFileSync(entry, 'module.exports = \"__HOOK_TEST_ONE__\";');\n\n      let watcher = new Watcher(webpack(config), options());\n\n      let onInvalidCalls = 0;\n      watcher.onInvalid(() => {\n        onInvalidCalls++;\n      });\n\n      let onDoneCalls = 0;\n      watcher.onDone(() => {\n        onDoneCalls++;\n      });\n\n      assert.equal(onInvalidCalls, 0);\n      assert.equal(onDoneCalls, 0);\n\n      watcher.onceDone((err, stats) => {\n        assert.isNull(err);\n        assert.isObject(stats);\n        assert.equal(onInvalidCalls, 0);\n        assert.equal(onDoneCalls, 1);\n        let onInvalidCalled = false;\n        let onDoneCalled = false;\n        watcher.onInvalid(_.once(() => {\n          assert.equal(onInvalidCalls, 1);\n          assert.equal(onDoneCalls, 1);\n          onInvalidCalled = true;\n          onDoneCalled && onInvalidCalled && done();\n        }));\n        watcher.onDone(_.once(() => {\n          assert.equal(onInvalidCalls, 1);\n          assert.equal(onDoneCalls, 2);\n          onDoneCalled = true;\n          onDoneCalled && onInvalidCalled && done();\n        }));\n        fs.writeFileSync(entry, 'module.exports = \"__HOOK_TEST_TWO__\";');\n      });\n    });\n  });\n  describe('#onceReady', () => {\n    it('should block until a bundle is generated', (done) => {\n      let compiler = webpack(basic_bundle());\n      let watcher = new Watcher(compiler, options());\n      watcher.onceDone((err, stats) => {\n        assert.isNull(err);\n        assert.isObject(stats);\n        let outputPath = path.join(TEST_OUTPUT_DIR, 'basic_bundle', 'output.js');\n        assert.equal(stats.compilation.assets['output.js'].existsAt, outputPath);\n        let content = fs.readFileSync(outputPath);\n        content = content.toString();\n        assert.include(content, '__BASIC_BUNDLE_ENTRY_TEST__');\n        assert.include(content, '__BASIC_BUNDLE_REQUIRE_TEST__');\n        done();\n      });\n    });\n    it('should block until an invalidated bundle has been rebuilt', (done) => {\n      let entry = path.join(TEST_OUTPUT_DIR, 'invalidated_bundle', 'entry.js');\n      let output = path.join(TEST_OUTPUT_DIR, 'invalidated_bundle', 'output.js');\n      let config = {\n        context: path.dirname(entry),\n        entry: './' + path.basename(entry),\n        output: {\n          path: path.dirname(output),\n          filename: path.basename(output)\n        }\n      };\n      mkdirp.sync(path.dirname(entry));\n      fs.writeFileSync(entry, 'module.exports = \"__INVALIDATED_BUNDLE_ONE__\";');\n      let watcher = new Watcher(webpack(config), options({\n        aggregateTimeout: 10\n      }));\n      watcher.onceDone((err, stats) => {\n        assert.isNull(err);\n        assert.isObject(stats);\n        assert.equal(stats.compilation.assets['output.js'].existsAt, output);\n        let content = fs.readFileSync(output);\n        assert.include(content.toString(), '__INVALIDATED_BUNDLE_ONE__');\n        setTimeout(() => {\n          watcher.onInvalid(_.once(() => {\n            assert.isNull(watcher.err);\n            assert.isNull(watcher.stats);\n            watcher.onceDone((err, stats) => {\n              assert.isNull(err);\n              assert.isObject(stats);\n              content = fs.readFileSync(output);\n              assert.include(content.toString(), '__INVALIDATED_BUNDLE_TWO__');\n              done();\n            });\n          }));\n          fs.writeFileSync(entry, 'module.exports = \"__INVALIDATED_BUNDLE_TWO__\";');\n        }, utils.watcherWarmUpWait);\n      });\n    });\n    it('should call onceDone if an error occurs', (done) => {\n      let config = {\n        context: '/path/does/not/exist/',\n        entry: './some_file.js',\n        output: {\n          path: '/another/path/that/does/not/exist',\n          filename: 'some_file.js'\n        }\n      };\n      let watcher = new Watcher(webpack(config), options());\n\n      watcher.onceDone((err) => {\n        assert.instanceOf(err, Error);\n        done();\n      });\n    });\n    it('should continue to detect changes and build the bundle', function(done) {\n      this.timeout(utils.watcherTimeout);\n\n      let entry = path.join(TEST_OUTPUT_DIR, 'persistent_watch', 'entry.js');\n      let output = path.join(TEST_OUTPUT_DIR, 'persistent_watch', 'output.js');\n\n      let compiler = webpack({\n        context: path.dirname(entry),\n        entry: './' + path.basename(entry),\n        output: {\n          path: path.dirname(output),\n          filename: path.basename(output)\n        }\n      });\n\n      let watcher = new Watcher(compiler, options());\n\n      mkdirp.sync(path.dirname(entry));\n\n      fs.writeFileSync(entry, 'module.exports = \"__WATCH_TEST_ONE__\";');\n      watcher.onceDone((err, stats) => {\n        assert.isNull(err);\n        assert.isObject(stats);\n        assert.equal(output, stats.compilation.assets['output.js'].existsAt);\n        let contents = fs.readFileSync(output);\n        let compiledBundle = contents.toString();\n        assert.include(compiledBundle, '__WATCH_TEST_ONE__');\n        setTimeout(() => {\n          fs.writeFileSync(entry, 'module.exports = \"__WATCH_TEST_TWO__\";');\n          setTimeout(() => {\n            watcher.onceDone((err, stats) => {\n              assert.isNull(err);\n              assert.isObject(stats);\n              assert.equal(output, stats.compilation.assets['output.js'].existsAt);\n              contents = fs.readFileSync(output);\n              assert.include(contents.toString(), '__WATCH_TEST_TWO__');\n              fs.writeFileSync(entry, 'module.exports = \"__WATCH_TEST_THREE__\";');\n              setTimeout(() => {\n                watcher.onceDone((err, stats) => {\n                  assert.isNull(err);\n                  assert.isObject(stats);\n                  assert.equal(output, stats.compilation.assets['output.js'].existsAt);\n                  contents = fs.readFileSync(output);\n                  assert.include(contents.toString(), '__WATCH_TEST_THREE__');\n                  done();\n                });\n              }, utils.watcherWait);\n            });\n          }, utils.watcherWait);\n        }, utils.watcherWarmUpWait);\n      });\n    });\n    it('should handle errors during compilation and preserve them', function(done) {\n      this.timeout(utils.watcherTimeout);\n\n      let entry = path.join(TEST_OUTPUT_DIR, 'watcher_caches_errors', 'entry.js');\n      let output = path.join(TEST_OUTPUT_DIR, 'watcher_caches_errors', 'output.js');\n\n      mkdirp.sync(path.dirname(entry));\n      fs.writeFileSync(entry, 'module.exports = \"__ERROR_TEST_ONE__\";');\n\n      let compiler = webpack({\n        context: path.dirname(entry),\n        entry: './' + path.basename(entry),\n        output: {\n          path: path.dirname(output),\n          filename: path.basename(output)\n        }\n      });\n\n      let watcher = new Watcher(compiler, options({\n        aggregateTimeout: utils.aggregateTimeout\n      }));\n\n      watcher.onceDone((err, stats) => {\n        assert.isNull(err);\n        assert.isObject(stats);\n        let contents = fs.readFileSync(output);\n        assert.include(contents.toString(), '__ERROR_TEST_ONE__');\n\n        setTimeout(() => {\n          fs.writeFileSync(entry, '?+');\n          setTimeout(() => {\n            assert.isNotNull(watcher.err);\n            assert.isNotNull(watcher.stats);\n            watcher.onceDone((err1, stats1) => {\n              assert.instanceOf(err1, Error);\n              assert.isObject(stats1);\n              assert.strictEqual(err1, watcher.err);\n              assert.strictEqual(stats1, watcher.stats);\n              watcher.onceDone((err2, stats2) => {\n                assert.instanceOf(err2, Error);\n                assert.strictEqual(err2, err1);\n                assert.strictEqual(err2, watcher.err);\n                assert.strictEqual(stats2, watcher.stats);\n\n                fs.writeFileSync(entry, 'module.exports = \"__ERROR_TEST_TWO__\";');\n                setTimeout(() => {\n                  watcher.onceDone((err3, stats3) => {\n                    assert.isNull(err3);\n                    assert.notStrictEqual(stats3, stats1);\n                    assert.isObject(stats3);\n                    let contents = fs.readFileSync(output);\n                    assert.include(contents.toString(), '__ERROR_TEST_TWO__');\n\n                    fs.writeFileSync(entry, '+?;');\n                    setTimeout(() => {\n                      watcher.onceDone((err4, stats4) => {\n                        assert.instanceOf(err4, Error);\n                        assert.notStrictEqual(err4, err1);\n                        assert.strictEqual(err4, watcher.err);\n                        assert.strictEqual(stats4, watcher.stats);\n                        watcher.onceDone((err5, stats5) => {\n                          assert.instanceOf(err5, Error);\n                          assert.notStrictEqual(err5, err1);\n                          assert.strictEqual(err5, err4);\n                          assert.strictEqual(err5, watcher.err);\n                          assert.strictEqual(stats5, stats4);\n                          assert.strictEqual(stats5, watcher.stats);\n\n                          fs.writeFileSync(entry, 'module.exports = \"__ERROR_TEST_THREE__\";');\n                          setTimeout(() => {\n                            watcher.onceDone((err6, stats6) => {\n                              assert.isNull(err6);\n                              assert.notStrictEqual(stats6, stats1);\n                              assert.isObject(stats6);\n                              assert.strictEqual(err6, watcher.err);\n                              assert.strictEqual(stats6, watcher.stats);\n                              let contents = fs.readFileSync(output);\n                              assert.include(contents.toString(), '__ERROR_TEST_THREE__');\n                              done();\n                            });\n                          }, utils.watcherWait);\n                        });\n                      });\n                    }, utils.watcherWait);\n                  });\n                }, utils.watcherWait);\n              });\n            });\n          }, utils.watcherWait);\n        }, utils.watcherWarmUpWait);\n      });\n    });\n  });\n});"]}