{"version":3,"sources":["../../src/hmr/config.js"],"names":[],"mappings":";;;;;;;;oBAAiB,MAAM;;;;sBACT,QAAQ;;;;uBACF,SAAS;;;;AAE7B,IAAM,SAAS,GAAG,SAAZ,SAAS,CAAI,MAAM,EAAE,IAAI,EAAK;AAClC,MAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACjB,UAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;GAClE;;AAED,MAAI,CAAC,IAAI,CAAC,UAAU,KAAK,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAA,AAAC,EAAE;AAC/D,UAAM,IAAI,KAAK,CAAC,2GAA2G,CAAC,CAAC;GAC9H;;AAED,MAAI,CAAC,IAAI,CAAC,UAAU,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAA,AAAC,EAAE;AAChF,UAAM,IAAI,KAAK,CAAC,iHAAiH,CAAC,CAAC;GACpI;;AAED,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC;AAChC,QAAI,EAAE,IAAI,CAAC,OAAO;AAClB,QAAI,EAAE,IAAI,CAAC,OAAO;AAClB,aAAS,EAAE,IAAI,CAAC,YAAY;GAC7B,CAAC,CAAC;;AAEH,MAAM,SAAS,GAAG,CACb,SAAS,gBAAW,UAAU,EACjC,6BAA6B,CAC9B,CAAC;;AAEF,QAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,IAAI,EAAE,CAAC;;AAElC,MAAI,oBAAE,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;AAC3B,UAAM,CAAC,KAAK,GAAG,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;GAC/C,MAAM,IAAI,oBAAE,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;AACnC,wBAAE,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,UAAC,KAAK,EAAE,GAAG,EAAK;AACtC,YAAM,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;KAC7C,CAAC,CAAC;GACJ,MAAM;AACL,UAAM,CAAC,KAAK,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;GACjD;;AAED,QAAM,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,EAAE,CAAC;;AAEtC,QAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,qBAAQ,0BAA0B,EAAE,CAAC,CAAC;;AAE9D,QAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,IAAI,EAAE,CAAC;;AAEpC,MAAI,IAAI,CAAC,UAAU,EAAE;AACnB,UAAM,CAAC,MAAM,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;GAC5C;;AAED,MAAI,UAAU,GAAG,IAAI,CAAC,UAAU,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;AACvD,QAAM,CAAC,WAAW,GAAG,kBAAK,IAAI,CAAC,UAAU,uBAAqB,IAAI,CAAC,SAAS,WAAQ,CAAC;CACtF,CAAC;;qBAEa,SAAS","file":"config.js","sourcesContent":["import path from 'path';\nimport _ from 'lodash';\nimport webpack from 'webpack';\n\nconst hmrConfig = (config, opts) => {\n  if (!opts.hmrRoot) {\n    throw new Error('hmrRoot must be defined to inject hmr runtime');\n  }\n\n  if (!opts.outputPath && (!config.output || !config.output.path)) {\n    throw new Error('the output.path prop must be defined in your config or as the outputPath option to inject the hmr runtime');\n  }\n\n  if (!opts.publicPath && (!config.output.publicPath || !config.output.publicPath)) {\n    throw new Error('the output.publicPath prop must be defined in your config or as the publicPath option to inject the hmr runtime');\n  }\n\n  const socketOpts = JSON.stringify({\n    root: opts.hmrRoot,\n    path: opts.hmrPath,\n    namespace: opts.hmrNamespace\n  });\n\n  const devClient = [\n    `${__dirname}/client?${socketOpts}`,\n    'webpack/hot/only-dev-server'\n  ];\n\n  config.entry = config.entry || [];\n\n  if (_.isArray(config.entry)) {\n    config.entry = devClient.concat(config.entry);\n  } else if (_.isObject(config.entry)) {\n    _.forEach(config.entry, (value, key) => {\n      config.entry[key] = devClient.concat(value);\n    });\n  } else {\n    config.entry = devClient.concat([config.entry]);\n  }\n\n  config.plugins = config.plugins || [];\n\n  config.plugins.push(new webpack.HotModuleReplacementPlugin());\n\n  config.output = config.output || {};\n\n  if (opts.publicPath) {\n    config.output.publicPath = opts.publicPath;\n  }\n\n  let outputPath = opts.outputPath || config.output.path;\n  config.recordsPath = path.join(outputPath, `webpack.records-${opts.buildHash}.json`);\n};\n\nexport default hmrConfig;"]}